var min_price=0;var max_price=2000;var min_time=0;var max_time=1440;jQuery(document).ready(function($){$("#slider-range_price").slider({range:true,min:min_price,max:max_price,values:[min_price,max_price],slide:function(event,ui){var my_id=$(this).attr("id");var delay=function(){var label='';if(ui.handle.nextSibling){label='min';}else{label='max';}
var my_label=$('#'+my_id).closest('.filter_cont').find('.val_disp.'+label);my_label.html('$'+ui.value).show().position({my:'center top',at:'center bottom',of:ui.handle,offset:"0, 10"});}
setTimeout(delay,5);if(ui.values[0]==min_price&&ui.values[1]==max_price){$("#price_range").html('הכל');}else{$("#price_range").html("$"+ui.values[1]+" - $"+ui.values[0]);}},change:function(event,ui){$(this).closest('.slider_cont');do_filter();}});$("#price_range").val('הכל');$(".time_range").slider({range:true,min:min_time,max:max_time,step:30,values:[0,max_time],slide:function(e,ui){var my_id=$(this).attr("id");var hours_start=Math.floor(ui.values[0]/60);var minutes_start=ui.values[0]-(hours_start*60);if(hours_start.toString().length==1)hours_start='0'+hours_start;if(minutes_start.toString().length==1)minutes_start='0'+minutes_start;var hours_end=Math.floor(ui.values[1]/60);var minutes_end=ui.values[1]-(hours_end*60);if(hours_end.toString().length==1)hours_end='0'+hours_end;if(minutes_end.toString().length==1)minutes_end='0'+minutes_end;var delay=function(){var label='';var my_text='';if(ui.handle.nextSibling){label='min';my_text=hours_start+':'+minutes_start;}else{label='max';my_text=hours_end+':'+minutes_end;}
var my_label=$('#'+my_id).closest('.filter_cont').find('.val_disp.'+label);my_label.html(my_text).show().position({my:'center top',at:'center bottom',of:ui.handle,offset:"0, 10"});}
setTimeout(delay,5);var my_range_displayer=$(this).closest('.slider_parent').find('.range_displayer');if(ui.values[0]==0&&ui.values[1]==max_time){my_range_displayer.html('הכל');}else{my_range_displayer.html(hours_start+':'+minutes_start+' - '+hours_end+':'+minutes_end);}},change:function(event,ui){$(this).closest('.slider_cont');do_filter();}});$(".range_displayer.time").val('הכל');$('.range_displayer').click(function(){var slider_cont=$(this).closest('.slider_parent').find('.slider_cont');slider_cont.show();});$('.reset_button').click(function(){reset();});$('.slider_cont .controls .all').click(function(){var my_slider=$(this).closest('.slider_cont').find('.my_range_slider');$(this).closest('.slider_cont').find('.val_disp').html('');var min=my_slider.slider("option","min");var max=my_slider.slider("option","max");my_slider.slider("option","values",[min,max]);$(this).closest('.slider_parent').find('.range_displayer').html('הכל');$(this).closest('.pop').hide();do_filter();});$('.select_panel .controls .all').click(function(){$(this).closest('.pop').find('input').attr('checked',true);$(this).closest('.selector_parent').find('.selection_displayer').html('הכל');$(this).closest('.pop').hide();do_filter();});function reset(){$('.pop input').prop('checked',false);$('.range_displayer').html('הכל');$('.selection_displayer').html('הכל');$('#slider-range_price').slider("values",0,min_price);$('#slider-range_price').slider("values",1,max_price);$('.time_range').slider("values",0,min_time);$('.time_range').slider("values",1,max_time);$('.flight_extra_info').hide();$('.flight_row').show();$('.flights_table').show();$('.no_results').hide();}
$('.pop.select_panel input').change(function(){var all_my_cboxs=$(this).closest('.pop').find('input');var num_selected=0;$.each(all_my_cboxs,function(){if($(this).is(':checked')){num_selected++;}});var total=all_my_cboxs.length;if(num_selected==total||num_selected==0){$(this).closest('.selector_parent').find('.selection_displayer').html('הכל');}else{$(this).closest('.selector_parent').find('.selection_displayer').html('חלקי');}
$(this).closest(".pop").hide();do_filter();});$('.full_view').click(function(){$(this).closest('.flight_row').find(".flight_extra_info").toggle();$(this).closest('.flight_row').toggleClass("opened");});$(".goto_flight").click(function(e){e.stopPropagation();})
$('.flight_extra_info').click(function(){$(this).toggle();$(this).closest('.flight_row').toggleClass("opened");});$('.flight_extra_info .hide_details').click(function(){$(this).closest('.flight_extra_info').click();event.stopPropagation();});$('.selection_displayer').click(function(){$('.pop').hide();$(this).closest('.filter_cont').find('.pop').show();});$('.filter_cont .fake_checkbox').click(function(){my_check=$(this).closest('.filter_cont').find('.hidden_check');$(this).closest('.filter_group').find('.hidden_check').not(my_check).attr('checked',false);if(my_check.is(":checked")){my_check.attr('checked',false);}else{my_check.attr('checked',true);}
do_filter()});$('.filter_cont select').change(function(){do_filter();});function do_filter(){$('.flight_extra_info').hide();$('.flight_row').not('.header_row').hide();$('.flight_row').removeClass('matched');$('.no_results').hide();var filter_list=create_filter_list();if(Object.keys(filter_list).length>0){var count=0;$(".flight_row").each(function(index){var res=check_item($(this),filter_list);if(res){count++;}});if(count==0){$('.no_results').show();$('.flights_table').hide();}else{$('.flights_table').show();}}else{$('.flight_row').show();}}
function create_filter_list(){var filter_list={};$(".filter_group").each(function(index){var param=$(this).attr('data-param');var found=false;var cboxes=$(this).find("[type='checkbox']:checked");var my_val='';if(cboxes.length!=0){my_val=[];cboxes.each(function(index){my_val.push($(this).val());});found=true;}
if(!found)
{}
if(!found)
{item=$(this).find(".range_displayer");if(item.length!=0&&item.html()!='הכל'){my_val=item.html();my_val=my_val.replace(/ /g,"");my_val=my_val.replace(/\$/g,"");found=true;}}
if(found){filter_list[param]=(my_val);}});return filter_list;}
function hours_mins_to_mins(my_time){my_time=my_time.split(":");my_time=(60*(parseInt(my_time[0])))+parseInt(my_time[1]);return my_time;}
function check_item(my_item,filter_list){var item=my_item;var match=false;var failed_once=false;$.each(filter_list,function(key,value){if(failed_once){match=false;return false;}
if(item.attr('data-'+key))
{if(key=='toff'||key=='toff_ret'){var my_time=hours_mins_to_mins(item.attr('data-'+key));var times=value.split("-");var min=hours_mins_to_mins(times[0]);var max=hours_mins_to_mins(times[1]);if(my_time>=min&&my_time<=max){match=true;}else{failed_once=true;match=false;return false;}}
else if(key=='price'){var prices=value.split("-");var min=parseInt(prices[1]);var max=parseInt(prices[0]);var my_price=parseInt(item.attr('data-'+key));if(my_price>=min&&my_price<=max){match=true;}else{failed_once=true;match=false;return false;}}else
{my_attr_val=item.attr('data-'+key);if($.inArray(my_attr_val,value)!==-1){match=true;}else{failed_once=true;match=false;return false;}}}else{match=false;return false;}});if(match){item.addClass('matched');item.show();return true;}else{return false;}}});